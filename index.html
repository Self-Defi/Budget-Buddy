<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Household Financial Operating Plan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f3f4f6;
      --card-bg: #ffffff;
      --accent: #0f5ba7;
      --accent-soft: #e5effa;
      --text-main: #111827;
      --text-muted: #4b5563;
      --border: #e5e7eb;
      --danger: #b91c1c;
      --ok: #15803d;
      --radius-lg: 18px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px 12px 80px;
    }

    h1 {
      text-align: center;
      font-size: 1.9rem;
      margin: 8px 0 4px;
      color: #0b2560;
    }

    .subtitle {
      text-align: center;
      color: var(--text-muted);
      margin-bottom: 18px;
      font-size: 0.95rem;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
    }

    .grid-1 {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 16px;
    }

    @media (max-width: 820px) {
      .grid-2 {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 16px 18px 14px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.06);
      border: 1px solid var(--border);
    }

    .card-header-pill {
      display: inline-block;
      padding: 4px 12px;
      border-radius: var(--radius-pill);
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .card h2 {
      margin: 0 0 4px;
      font-size: 1.05rem;
    }

    .card p {
      margin: 0;
      color: var(--text-muted);
      font-size: 0.88rem;
    }

    .field-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-top: 8px;
    }

    .field-row label {
      font-size: 0.9rem;
    }

    .field-row input[type="number"] {
      width: 120px;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 0.9rem;
      text-align: right;
    }

    .field-row input[type="date"] {
      padding: 5px 8px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 0.85rem;
    }

    .metric-main {
      font-size: 1.15rem;
      font-weight: 600;
      margin-top: 4px;
    }

    .metric-main span {
      color: var(--accent);
    }

    .muted {
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    ul.routing-list {
      margin: 6px 0;
      padding-left: 18px;
      font-size: 0.9rem;
    }

    ul.routing-list li {
      margin-bottom: 2px;
    }

    .table-wrap {
      width: 100%;
      overflow-x: auto;
      margin-top: 8px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 520px;
      font-size: 0.85rem;
    }

    th,
    td {
      padding: 6px 8px;
      border: 1px solid var(--border);
      text-align: right;
      white-space: nowrap;
    }

    th {
      background: #eff3fb;
      color: #1f2937;
      font-weight: 600;
    }

    td:first-child,
    th:first-child {
      text-align: left;
    }

    .net-row {
      margin-top: 8px;
      font-size: 0.95rem;
      font-weight: 600;
    }

    .net-row span {
      color: var(--accent);
    }

    .bill-table td {
      font-size: 0.8rem;
    }

    .bill-table input[type="checkbox"] {
      transform: scale(1.05);
    }

    .bill-status-ok {
      color: var(--ok);
      font-weight: 600;
    }

    .bill-status-warn {
      color: #b45309;
      font-weight: 600;
    }

    .bill-status-bad {
      color: var(--danger);
      font-weight: 600;
    }

    .bill-paid-row {
      background: #ecfdf3;
    }

    .button-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 18px;
    }

    .btn-refresh {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 18px;
      border-radius: var(--radius-pill);
      border: none;
      background: #0f5ba7;
      color: #fff;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(15, 91, 167, 0.35);
    }

    .btn-refresh:active {
      transform: translateY(1px);
      box-shadow: 0 6px 14px rgba(15, 91, 167, 0.4);
    }

    .btn-refresh span.icon {
      display: inline-block;
      font-size: 1.05rem;
    }

    .notes ul {
      margin: 6px 0 0;
      padding-left: 18px;
      font-size: 0.88rem;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>Household Financial Operating Plan</h1>
    <div class="subtitle">
      Interactive 24-Month Roadmap — All values editable
    </div>

    <!-- Top row: Income + Free Cash -->
    <div class="grid-2">
      <div class="card">
        <div class="card-header-pill">Income Engine</div>
        <h2>Monthly Income</h2>
        <p>This is the total income per month that funds all household operating expenses and allocations.</p>

        <div class="field-row" style="margin-top:10px;">
          <label for="incomeInput">Monthly planning base</label>
          <input id="incomeInput" type="number" min="0" step="1" />
        </div>
      </div>

      <div class="card">
        <div class="card-header-pill">Liquidity</div>
        <h2>Free Cash Flow (Calculated)</h2>
        <div class="metric-main">
          Free Cash Flow per month:
          <span id="freeCashDisplay">$0</span>
        </div>
        <ul class="muted" style="margin-top:6px;">
          <li>Calculated as income minus all household operating expenses (including reserves and investment).</li>
          <li>Used for opportunities, shocks, or targeted extra debt paydown.</li>
        </ul>
      </div>
    </div>

    <!-- HOE + External CC -->
    <div class="grid-2" style="margin-top:16px;">
      <div class="card">
        <div class="card-header-pill">Core Structure</div>
        <h2>Household Operating Expenses (funded by monthly income)</h2>

        <div class="field-row">
          <label for="mortgageInput">Mortgage</label>
          <input id="mortgageInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="autoInput">Auto Loans (total)</label>
          <input id="autoInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="insuranceInput">Household Insurance</label>
          <input id="insuranceInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="utilitiesInput">Utilities</label>
          <input id="utilitiesInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="settlementInput">Settlement Program</label>
          <input id="settlementInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="chaseInput">Chase Bank Repayment</label>
          <input id="chaseInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="parentCCInput">Parent Credit Card Repayment</label>
          <input id="parentCCInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="groceriesInput">Groceries</label>
          <input id="groceriesInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="fuelInput">Fuel</label>
          <input id="fuelInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="parentRewardInput">Parent Reward System</label>
          <input id="parentRewardInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="emergencyInput">Emergency Operating Reserve</label>
          <input id="emergencyInput" type="number" min="0" step="1" />
        </div>
        <div class="field-row">
          <label for="investmentInput">Investment Account Deposit</label>
          <input id="investmentInput" type="number" min="0" step="1" />
        </div>

        <div class="metric-main" style="margin-top:10px;">
          Total Household Operating Expenses:
          <span id="totalHOEDisplay">$0</span> per month
        </div>
      </div>

      <div class="card">
        <div class="card-header-pill">Debt Acceleration</div>
        <h2>External Principal Reduction</h2>

        <div class="field-row">
          <label for="kidsCCInput">Kids CC Contribution (external)</label>
          <input id="kidsCCInput" type="number" min="0" step="1" />
        </div>
        <p class="muted" style="margin-top:6px;">
          Kids’ contribution is not funded from monthly income. It goes directly to credit card principal.
        </p>

        <div class="metric-main" style="margin-top:10px;">
          Total Credit Card principal reduction per month (parents + kids):
          <span id="totalCCReductionDisplay">$0</span>
        </div>
      </div>
    </div>

    <!-- Bi-weekly routing -->
    <div class="grid-2" style="margin-top:18px;">
      <div class="card">
        <div class="card-header-pill">Bi-Weekly Routing</div>
        <h2>Paycheck 1 Routing (Reference)</h2>
        <ul class="routing-list">
          <li>Mortgage — <span id="p1-mortgage">$0</span></li>
          <li>Groceries — <span id="p1-groceries">$0</span></li>
          <li>Fuel — <span id="p1-fuel">$0</span></li>
          <li>Settlement — <span id="p1-settlement">$0</span></li>
          <li>Parent Reward — <span id="p1-parentReward">$0</span></li>
          <li>Parent CC Repayment — <span id="p1-parentCC">$0</span></li>
          <li>Investment — <span id="p1-investment">$0</span></li>
          <li>Emergency Reserve — <span id="p1-emergency">$0</span></li>
          <li>Free Cash — <span id="p1-freeCash">$0</span></li>
        </ul>
        <p class="muted">
          Reference values based on the default plan. If you change the inputs above, use this as a guide and adjust manually.
        </p>
      </div>

      <div class="card">
        <div class="card-header-pill">Bi-Weekly Routing</div>
        <h2>Paycheck 2 Routing (Reference)</h2>
        <ul class="routing-list">
          <li>Auto Loans — <span id="p2-auto">$0</span></li>
          <li>Household Insurance — <span id="p2-insurance">$0</span></li>
          <li>Utilities — <span id="p2-utilities">$0</span></li>
          <li>Settlement — <span id="p2-settlement">$0</span></li>
          <li>Chase — <span id="p2-chase">$0</span></li>
          <li>Groceries — <span id="p2-groceries">$0</span></li>
          <li>Fuel — <span id="p2-fuel">$0</span></li>
          <li>Parent Reward — <span id="p2-parentReward">$0</span></li>
          <li>Parent CC Repayment — <span id="p2-parentCC">$0</span></li>
          <li>Investment — <span id="p2-investment">$0</span></li>
          <li>Emergency Reserve — <span id="p2-emergency">$0</span></li>
          <li>Free Cash — <span id="p2-freeCash">$0</span></li>
        </ul>
        <p class="muted">
          Paycheck 2 clears the remaining fixed obligations and leaves the bulk of monthly Free Cash.
        </p>
      </div>
    </div>

    <!-- Projections -->
    <div class="card" style="margin-top:18px;">
      <div class="card-header-pill">Projection – 24 Months</div>
      <h2>Quarterly Projections (2-Year Plan)</h2>
      <p class="muted">
        All values below update automatically when you change numbers in the inputs above.
      </p>
      <div class="table-wrap">
        <table id="projectionTable">
          <thead>
            <tr>
              <th>Quarter</th>
              <th>Free Cash (3 mo)</th>
              <th>Investment (3 mo)</th>
              <th>Parent Reward (3 mo)</th>
              <th>CC Reduction (3 mo)</th>
            </tr>
          </thead>
          <tbody>
            <!-- rows rendered by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <div class="card" style="margin-top:16px;">
      <div class="card-header-pill">Cumulative View</div>
      <h2>Cumulative Performance Over 2 Years</h2>
      <div class="table-wrap">
        <table id="cumulativeTable">
          <thead>
            <tr>
              <th>Quarter</th>
              <th>Cumulative Free Cash</th>
              <th>Cumulative Investment</th>
              <th>Cumulative Parent Reward</th>
              <th>Cumulative CC Reduction</th>
            </tr>
          </thead>
          <tbody>
            <!-- rows rendered by JS -->
          </tbody>
        </table>
      </div>
      <div class="net-row" id="netPositionRow">
        Net position improvement after 24 months (Free Cash + Investment Funding + Parent Reward + Debt Eliminated):
        <span id="netPositionDisplay">$0</span>
      </div>
    </div>

    <!-- Bill tracking -->
    <div class="card" style="margin-top:16px;">
      <div class="card-header-pill">Bill Tracking</div>
      <h2>Bill Due Dates &amp; Payment Status</h2>
      <p class="muted">
        Due dates and “Paid this month” status are stored in your browser only and reset automatically each month.
      </p>
      <div class="table-wrap">
        <table class="bill-table">
          <thead>
            <tr>
              <th>Bill</th>
              <th>Amount (current)</th>
              <th>Due Date</th>
              <th>Status</th>
              <th>Paid this month</th>
            </tr>
          </thead>
          <tbody id="billTableBody">
            <!-- rows rendered by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Governance notes -->
    <div class="card notes" style="margin-top:16px;">
      <div class="card-header-pill">Governance Notes</div>
      <h2>Executive Notes</h2>
      <ul>
        <li>Household remains structurally oriented toward solvency if income and expenses stay within planned ranges.</li>
        <li>Every critical obligation is funded before Free Cash Flow is counted.</li>
        <li>Total credit card principal reduced each month consists of parents’ repayment (if any) plus kids’ contribution.</li>
        <li>Parent Reward System is intentional: it maintains long-term discipline and cooperation.</li>
        <li>When credit card debt is fully repaid, that monthly amount can be reallocated to reserves, investments, or other growth strategies.</li>
      </ul>
    </div>

    <div class="button-row">
      <button id="refreshButton" class="btn-refresh">
        <span class="icon">⟳</span>
        <span>Refresh Plan</span>
      </button>
    </div>
  </div>

  <script>
    // ----- Defaults -----
    const defaultState = {
      income: 9500,
      mortgage: 3500,
      auto: 1290,
      insurance: 1000,
      utilities: 400,
      settlement: 276,
      chase: 150,
      parentCC: 0, // default set to zero per request
      groceries: 650,
      fuel: 300,
      parentReward: 400,
      emergency: 200,
      investment: 450,
      kidsCC: 200,
      bills: {},
      billsPaid: {},
      monthKey: getMonthKey()
    };

    function getMonthKey() {
      const d = new Date();
      return d.getFullYear() + "-" + (d.getMonth() + 1);
    }

    const STORAGE_KEY = "budgetBuddyState";

    function formatCurrency(n) {
      return new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
        maximumFractionDigits: 0
      }).format(Math.round(n || 0));
    }

    function getNumber(id) {
      const el = document.getElementById(id);
      if (!el) return 0;
      const v = parseFloat(el.value);
      return isNaN(v) ? 0 : v;
    }

    function setInput(id, value) {
      const el = document.getElementById(id);
      if (el) el.value = value;
    }

    function setText(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value;
    }

    // ----- State load / save -----
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return { ...defaultState };
        const parsed = JSON.parse(raw);
        // reset monthly bill statuses if month changed
        const monthKey = getMonthKey();
        if (parsed.monthKey !== monthKey) {
          parsed.billsPaid = {};
          parsed.monthKey = monthKey;
        }
        return { ...defaultState, ...parsed };
      } catch {
        return { ...defaultState };
      }
    }

    function saveState(state) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    let appState = loadState();

    function applyStateToInputs() {
      setInput("incomeInput", appState.income);
      setInput("mortgageInput", appState.mortgage);
      setInput("autoInput", appState.auto);
      setInput("insuranceInput", appState.insurance);
      setInput("utilitiesInput", appState.utilities);
      setInput("settlementInput", appState.settlement);
      setInput("chaseInput", appState.chase);
      setInput("parentCCInput", appState.parentCC);
      setInput("groceriesInput", appState.groceries);
      setInput("fuelInput", appState.fuel);
      setInput("parentRewardInput", appState.parentReward);
      setInput("emergencyInput", appState.emergency);
      setInput("investmentInput", appState.investment);
      setInput("kidsCCInput", appState.kidsCC);
    }

    // ----- Routing helpers -----
    function splitAmount(amount) {
      const first = Math.round(amount / 2);
      const second = amount - first;
      return [first, second];
    }

    // ----- Bills table -----
    const billDefinitions = [
      { key: "mortgage", label: "Mortgage", inputId: "mortgageInput" },
      { key: "auto", label: "Auto Loans", inputId: "autoInput" },
      { key: "insurance", label: "Household Insurance", inputId: "insuranceInput" },
      { key: "utilities", label: "Utilities", inputId: "utilitiesInput" },
      { key: "settlement", label: "Settlement Program", inputId: "settlementInput" },
      { key: "chase", label: "Chase Bank Repayment", inputId: "chaseInput" },
      { key: "groceries", label: "Groceries", inputId: "groceriesInput" },
      { key: "fuel", label: "Fuel", inputId: "fuelInput" },
      { key: "parentReward", label: "Parent Reward System", inputId: "parentRewardInput" },
      { key: "emergency", label: "Emergency Operating Reserve", inputId: "emergencyInput" },
      { key: "investment", label: "Investment Account Deposit", inputId: "investmentInput" }
    ];

    function buildBillTable() {
      const tbody = document.getElementById("billTableBody");
      tbody.innerHTML = "";
      billDefinitions.forEach((bill) => {
        const tr = document.createElement("tr");
        tr.id = "bill-row-" + bill.key;

        const tdName = document.createElement("td");
        tdName.textContent = bill.label;

        const tdAmt = document.createElement("td");
        tdAmt.id = "bill-amt-" + bill.key;
        tdAmt.textContent = formatCurrency(getNumber(bill.inputId));

        const tdDate = document.createElement("td");
        const dateInput = document.createElement("input");
        dateInput.type = "date";
        dateInput.id = "bill-date-" + bill.key;
        if (appState.bills[bill.key]) {
          dateInput.value = appState.bills[bill.key];
        }
        tdDate.appendChild(dateInput);

        const tdStatus = document.createElement("td");
        tdStatus.id = "bill-status-" + bill.key;
        tdStatus.textContent = "No date set";

        const tdPaid = document.createElement("td");
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.id = "bill-paid-" + bill.key;
        cb.checked = !!appState.billsPaid[bill.key];
        tdPaid.appendChild(cb);

        tr.appendChild(tdName);
        tr.appendChild(tdAmt);
        tr.appendChild(tdDate);
        tr.appendChild(tdStatus);
        tr.appendChild(tdPaid);

        tbody.appendChild(tr);
      });
      updateBillStatuses();
      attachBillListeners();
    }

    function attachBillListeners() {
      billDefinitions.forEach((bill) => {
        const dateInput = document.getElementById("bill-date-" + bill.key);
        const paidInput = document.getElementById("bill-paid-" + bill.key);
        if (dateInput) {
          dateInput.addEventListener("change", () => {
            appState.bills[bill.key] = dateInput.value || null;
            saveState(appState);
            updateBillStatuses();
          });
        }
        if (paidInput) {
          paidInput.addEventListener("change", () => {
            appState.billsPaid[bill.key] = paidInput.checked;
            saveState(appState);
            updateBillStatuses();
          });
        }
      });
    }

    function updateBillStatuses() {
      const today = new Date();
      billDefinitions.forEach((bill) => {
        const row = document.getElementById("bill-row-" + bill.key);
        const statusEl = document.getElementById("bill-status-" + bill.key);
        if (!row || !statusEl) return;

        row.classList.remove("bill-paid-row");
        statusEl.classList.remove(
          "bill-status-ok",
          "bill-status-warn",
          "bill-status-bad"
        );

        const paid = !!appState.billsPaid[bill.key];
        const dateStr = appState.bills[bill.key];

        if (paid) {
          statusEl.textContent = "Paid this month";
          statusEl.classList.add("bill-status-ok");
          row.classList.add("bill-paid-row");
          return;
        }

        if (!dateStr) {
          statusEl.textContent = "No date set";
          return;
        }

        const due = new Date(dateStr);
        const diffMs = due.getTime() - today.getTime();
        const diffDays = Math.ceil(diffMs / (1000 * 60 * 60 * 24));

        if (diffDays < 0) {
          statusEl.textContent = "Overdue";
          statusEl.classList.add("bill-status-bad");
        } else if (diffDays === 0) {
          statusEl.textContent = "Due today";
          statusEl.classList.add("bill-status-warn");
        } else {
          statusEl.textContent = "Due in " + diffDays + " days";
          statusEl.classList.add("bill-status-warn");
        }
      });
    }

    // ----- Main calculations -----
    function updateCalculations() {
      // Pull values
      appState.income = getNumber("incomeInput");
      appState.mortgage = getNumber("mortgageInput");
      appState.auto = getNumber("autoInput");
      appState.insurance = getNumber("insuranceInput");
      appState.utilities = getNumber("utilitiesInput");
      appState.settlement = getNumber("settlementInput");
      appState.chase = getNumber("chaseInput");
      appState.parentCC = getNumber("parentCCInput");
      appState.groceries = getNumber("groceriesInput");
      appState.fuel = getNumber("fuelInput");
      appState.parentReward = getNumber("parentRewardInput");
      appState.emergency = getNumber("emergencyInput");
      appState.investment = getNumber("investmentInput");
      appState.kidsCC = getNumber("kidsCCInput");
      appState.monthKey = getMonthKey();

      saveState(appState);

      const income = appState.income;
      const {
        mortgage,
        auto,
        insurance,
        utilities,
        settlement,
        chase,
        parentCC,
        groceries,
        fuel,
        parentReward,
        emergency,
        investment,
        kidsCC
      } = appState;

      const totalHOE =
        mortgage +
        auto +
        insurance +
        utilities +
        settlement +
        chase +
        parentCC +
        groceries +
        fuel +
        parentReward +
        emergency +
        investment;

      const freeCashMonthly = income - totalHOE;

      setText("totalHOEDisplay", formatCurrency(totalHOE));
      setText("freeCashDisplay", formatCurrency(freeCashMonthly));

      // Credit card reduction (parents + kids)
      const totalCCReductionMonthly = parentCC + kidsCC;
      setText(
        "totalCCReductionDisplay",
        formatCurrency(totalCCReductionMonthly)
      );

      // ----- Routing logic -----
      const incomePerCheck = income / 2;

      // Items assigned fully to one paycheck
      const p1Mortgage = mortgage;
      const p2Auto = auto;
      const p2Insurance = insurance;
      const p2Utilities = utilities;
      const p2Chase = chase;

      // Shared items split evenly
      const [p1Settlement, p2Settlement] = splitAmount(settlement);
      const [p1Groceries, p2Groceries] = splitAmount(groceries);
      const [p1Fuel, p2Fuel] = splitAmount(fuel);
      const [p1ParentReward, p2ParentReward] = splitAmount(parentReward);
      const [p1ParentCC, p2ParentCC] = splitAmount(parentCC);
      const [p1Investment, p2Investment] = splitAmount(investment);
      const [p1Emergency, p2Emergency] = splitAmount(emergency);

      const p1HOE =
        p1Mortgage +
        p1Groceries +
        p1Fuel +
        p1Settlement +
        p1ParentReward +
        p1ParentCC +
        p1Investment +
        p1Emergency;

      const p2HOE =
        p2Auto +
        p2Insurance +
        p2Utilities +
        p2Settlement +
        p2Chase +
        p2Groceries +
        p2Fuel +
        p2ParentReward +
        p2ParentCC +
        p2Investment +
        p2Emergency;

      const p1Free = incomePerCheck - p1HOE;
      const p2Free = incomePerCheck - p2HOE;

      // Update routing display
      setText("p1-mortgage", formatCurrency(p1Mortgage));
      setText("p1-groceries", formatCurrency(p1Groceries));
      setText("p1-fuel", formatCurrency(p1Fuel));
      setText("p1-settlement", formatCurrency(p1Settlement));
      setText("p1-parentReward", formatCurrency(p1ParentReward));
      setText("p1-parentCC", formatCurrency(p1ParentCC));
      setText("p1-investment", formatCurrency(p1Investment));
      setText("p1-emergency", formatCurrency(p1Emergency));
      setText("p1-freeCash", formatCurrency(p1Free));

      setText("p2-auto", formatCurrency(p2Auto));
      setText("p2-insurance", formatCurrency(p2Insurance));
      setText("p2-utilities", formatCurrency(p2Utilities));
      setText("p2-settlement", formatCurrency(p2Settlement));
      setText("p2-chase", formatCurrency(p2Chase));
      setText("p2-groceries", formatCurrency(p2Groceries));
      setText("p2-fuel", formatCurrency(p2Fuel));
      setText("p2-parentReward", formatCurrency(p2ParentReward));
      setText("p2-parentCC", formatCurrency(p2ParentCC));
      setText("p2-investment", formatCurrency(p2Investment));
      setText("p2-emergency", formatCurrency(p2Emergency));
      setText("p2-freeCash", formatCurrency(p2Free));

      // Update bill amounts
      billDefinitions.forEach((bill) => {
        const amtCell = document.getElementById("bill-amt-" + bill.key);
        if (amtCell) {
          amtCell.textContent = formatCurrency(getNumber(bill.inputId));
        }
      });

      // Projections + cumulative
      updateProjections(
        freeCashMonthly,
        investment,
        parentReward,
        totalCCReductionMonthly
      );

      updateBillStatuses();
    }

    function updateProjections(
      freeCashMonthly,
      investMonthly,
      rewardMonthly,
      ccMonthly
    ) {
      const projBody = document.querySelector("#projectionTable tbody");
      const cumBody = document.querySelector("#cumulativeTable tbody");
      projBody.innerHTML = "";
      cumBody.innerHTML = "";

      let cumFree = 0;
      let cumInvest = 0;
      let cumReward = 0;
      let cumCC = 0;

      for (let q = 1; q <= 8; q++) {
        const qLabel = "Q" + q;

        const free3 = freeCashMonthly * 3;
        const inv3 = investMonthly * 3;
        const rew3 = rewardMonthly * 3;
        const cc3 = ccMonthly * 3;

        // Projection row
        const trP = document.createElement("tr");
        trP.innerHTML =
          "<td>" +
          qLabel +
          "</td>" +
          "<td>" +
          formatCurrency(free3) +
          "</td>" +
          "<td>" +
          formatCurrency(inv3) +
          "</td>" +
          "<td>" +
          formatCurrency(rew3) +
          "</td>" +
          "<td>" +
          formatCurrency(cc3) +
          "</td>";
        projBody.appendChild(trP);

        // Cumulative row
        cumFree += free3;
        cumInvest += inv3;
        cumReward += rew3;
        cumCC += cc3;

        const trC = document.createElement("tr");
        trC.innerHTML =
          "<td>" +
          qLabel +
          "</td>" +
          "<td>" +
          formatCurrency(cumFree) +
          "</td>" +
          "<td>" +
          formatCurrency(cumInvest) +
          "</td>" +
          "<td>" +
          formatCurrency(cumReward) +
          "</td>" +
          "<td>" +
          formatCurrency(cumCC) +
          "</td>";
        cumBody.appendChild(trC);
      }

      const net24 =
        freeCashMonthly * 24 +
        investMonthly * 24 +
        rewardMonthly * 24 +
        ccMonthly * 24;
      setText("netPositionDisplay", formatCurrency(net24));
    }

    // ----- Refresh Plan -----
    function refreshPlan() {
      localStorage.removeItem(STORAGE_KEY);
      appState = { ...defaultState, monthKey: getMonthKey() };
      applyStateToInputs();
      buildBillTable();
      updateCalculations();
    }

    // ----- Init -----
    document.addEventListener("DOMContentLoaded", () => {
      applyStateToInputs();
      buildBillTable();
      updateCalculations();

      // Listeners for numeric inputs
      const numericInputs = document.querySelectorAll('input[type="number"]');
      numericInputs.forEach((input) => {
        input.addEventListener("input", () => {
          updateCalculations();
        });
      });

      document
        .getElementById("refreshButton")
        .addEventListener("click", () => {
          refreshPlan();
        });
    });
  </script>
</body>
</html>




